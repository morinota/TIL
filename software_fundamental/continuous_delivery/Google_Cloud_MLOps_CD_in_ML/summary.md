# MLシステムにおけるContinuous Deliveryについてまとめる

## Continuous Deliveryのことをざっくり

### Continuous Deliveryの5つの原則

継続的デリバリーの中心には、以下の5つの原則がある。

- 1. **品質を組み込む(Build Quality In)**
- 2. 小さいbatchで作業する(Work in Small Batches)
- 3. コンピュータに反復タスクをさせ、人間は問題解決に集中する(Computers Perform Repetitive Tasks, People Solve Problems)
- 4. 絶え間なく継続的改善を追求する(Relentlessly Pursue Continuous Improvement)
- 5. 皆が責任を持つ(Everyone is Responsible)

#### 原則1 「品質を組み込む(Build Quality In)」

- リーン運動で有名らしいエドワーズ・デミングの「マネジメントの為の14の主要原則」の中の第3原則に基づく。
  - 第3原則「**品質を達成するために検査に依存するのをやめよ。最初からプロダクトに品質を組み込むことによって、大量の検査を必要としないようにせよ**」
  - (プロダクトに品質保証の振る舞いを組み込む、みたいな...??:thinking:プロダクトコードの一部としてのテストコードとかの話か...!)
- ローカル環境で自動テストを実行して、**問題や欠陥を即座に見つける事ができれば、理想的にはバージョン管理にチェックインされる前に見つけることができれば、問題や欠陥を修正するコストははるかに安くなる**。
  - 検査(手動テストなど)を通じて下流側で欠陥を見つけることは、時間がかかり、大規模なトリアージ(整理すること??:thinking:)が必要となる。
  - リリース後に欠陥を見つける場合、まずバージョン管理システム上で、原因となったPRやcommitを見つける必要がある。そして、**数日前、あるいは数週間前にcommitした時に考えていたことを思い出しながら、不具合を修正しなければならない...!** (早く発見できた方が圧倒的に楽...!:thinking:)
- 問題や欠陥を可能な限り早期に発見する為のfeedback loop (=CD pipeline?)を作り、それを進化させ続ける事は、継続的デリバリーにおいて不可欠な作業。
  - 探索的テスト(=開発者による不具合発生後のテスト??)で問題を見つけた場合、プロダクトコード内の原因箇所を修正するだけでなく、次にこう尋ねる必要がある
    - 「**その問題を、自動受け入れテストで検出する事は可能だったのか??**」
    - もし受け入れテストでその問題を検出できた場合...
      - 「**その問題を、ユニットテストで検出する事は可能だったのか??**」
    - (質問の答えがYesなのであれば、次回以降はその問題を自動テストで検知できるようにしていく...!全てのテストケースを最初から網羅する事はできないだろうし:thinking:)

#### 原則2 「小ロットで仕事をする(Work in Small Batches)」

- 従来の段階的なソフトウェア開発アプローチでは...
  - 開発->テスト->テスト->運用へのリリース全体の流れは、数十人から数百人からなるチームによる、数カ月分の作業。
- 継続的デリバリーでは、逆のアプローチを取る。
  - **可能な限りすべての変更をバージョン管理に取り込み、できるだけ迅速に包括的なフィードバックを得る事を目指す**。
- 小ロットでの作業には多くの利点がある。
  - **仕事にフィードバックを得る時間を短縮**し、問題の整理と解決を用意にする(なるほど...!このPRが原因だってすぐに分かる!)
  - 効率とモチベーションを高める(確かに! PR mergeできると嬉しい)、
  - 沈没コストの誘惑から守る。(柔軟に方向転換できる、みたいな??:thinking:)
- なぜ従来は大ロットで作業をしていたのかというと...
  - (次の工程のチームに)変更を引き渡すための固定費が大きいから。
    - (そもそも開発、テスト、運用を別々のチームが担ってるから、この変更引き渡しのコストが大きい...??:thinking:)
- 継続的デリバリーの主要な目標のひとつ:
  - ソフトウェアデリバリープロセスの経済を変え、**小ロットでの作業が経済的に可能になるようにする事で**、このアプローチの多くの利点を得ること。
  - (小ロットでの作業を経済的に可能にする = 開発、テスト、運用のチームを一つのチームにまとめるってこと?:thinking:)

#### 原則3 「コンピュータに反復タスクをさせ、人間は問題解決に集中する(Computers Perform Repetitive Tasks, People Solve Problems)」

- トヨタ伝統の哲学的思想の一つに「自動化」がある。
  - その目的は、**regression testの様な単純で反復的な作業はコンピュータに行わせ、人間は問題解決に集中できるようにする事**。
  - ↑のように、コンピュータと人間は互いに補完し合う。
  - (ABテストダッシュボード作成業務を自動化してぇ～)
- 多くの人は、自動化によって仕事がなくなるのではないかと心配するが...
  - まず、人々は頭を使わない雑務から解放され、より価値の高い活動に集中することができる。
    - 成功している会社で仕事が不足することはない。
  - また、品質を向上させる利点もある。
    - なぜなら、人間は、頭を使わない作業をするときに最もミスを犯しやすいからだ。

#### 原則4 「絶え間なく継続的改善を追求する(Relentlessly Pursue Continuous Improvement)」

- 継続的改善(Continuous Improvement)も、リーン運動の重要なアイデアの一つ。
  - トヨタ自動車のTaiichi Ohno の言葉「カイゼンの機会は無限にある」が有名。
  - **以前よりも良くなったと思って安心してはいけない**。
    - 剣術で3回中2回師匠に勝ったという生徒が誇りに思うのと同じ。
  - 改善アイデアの芽を1つ摘むと、日常の仕事の中で、**1つの改善アイデアのすぐ下にもう1つの改善アイデアがある**という態度を持つことが重要。
    - (この「改善アイデアの芽を摘む」という表現は、low hanging fruit的な表現と似てるな...!)
- "改善"を1つのプロジェクトとして扱って完了してしまい、日常業務に戻るべきではない。
  - **最良の組織とは、全員が改善活動を日常業務の不可欠な一部として扱い、誰も現状に満足しない組織**である

#### 原則5 「皆が責任を持つ(Everyone is Responsible)」

- 高い業績を上げている組織では、"誰か他の人の問題"は存在しない
  - 開発チームは、自分たちが構築したソフトウェアの品質と安定性(i.e. 運用しやすさ)に責任を持つ。一方で、運用チームは、開発チームの品質構築を支援する責任がある。
  - **自分のチームや部署に最適なものを最適化するのではなく、組織全体の目標を達成するためにみんなで協力する**。
    - (うーん、これはABテストで最適化すべきmetricsについても言えることだよなぁ...:thinking:)
- 人々が局所的な最適化を行うと、組織全体としてのパフォーマンスが低下することがある。
  - ↑はしばしば、間違った行動にインセンティブを与えるようなシステム的な問題が原因だったりする。
    - ex.) 開発者に対して速度を上げることや多くのコードを書くことを報酬とし、テスターには見つけたバグの数に基づいて報酬を与えること。
    - (これはよく例で挙げられてるやつ! :thinking:)
- 多くの人間は正しい事をしたいと思っている。しかし、人間は報酬に基づいて行動を適応させるもの。
  - -> **本当に重要なことからのフィードバック・ループを作成することが非常に重要!**(重要なmetricsを考える...!)
    - ex. 我々が開発したプロダクトにユーザがどのように反応しているか、組織への利益は??
