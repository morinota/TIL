# イントロダクション

## 空間情報(クロスセクション含む)の自己相関の理解が浅い話

## 空間的な自己相関が存在する

## 今回想定する例題

今回はヘドニック回帰(hedonic Regression)(＝基本的な線形回帰??)を例題として取り上げているが、紹介する手法群は様々な問題に適用可能。

- Hednic理論：
  - ミクロ経済学の理論。
  - 「品質によって財やサービスの値段が変わる。そうした品質の違いを前提に、需要と供給を考えましょう」みたいな理論。
- ヘドニック回帰：
  - ｙ(財やサービスの価格)、X(財やサービスの品質・特徴を表す変数)の関係を回帰分析で表すこと？
  - yはリンゴでも住宅でもOK!価格なら！

以下の章では、自己相関構造のモデル化に関わる基本的な問題を議論し、最も一般的に使用されている手法を比較対照する。

# 空間的自己相関のモデル化方法

空間的自己相関のモデル化には、一般的に2種類の方法がある。

- 1. (誤差項を生成する)プロセス自体をモデル化する方法。
  - 地理学者geographers(Cliff and Ord, 1981)の研究に基づく。
  - **重み行列weight matrix**を使用する必要がある。
  - Spatial Econometricsの文献では、より一般的なアプローチ。
- 2. 誤差項の共分散行列を直接モデル化する方法。
  - 地質学者geologistsの研究に基づく。

# (誤差項を生成する)プロセス自体をモデル化する方法

このアプローチでは、誤差項を生成するプロセスを明示的にモデル化する。このプロセスにおける最もシンプルなモデルは以下。

$$
Y = X \beta + \mathbf{u} \tag{1.a}
$$

$$
\mathbf{u} = \lambda W \mathbf{u} + \mathbf{\epsilon} \\
(\epsilon_i \sim Norm(\mu = 0, \sigma^2))
\tag{1.b}
$$

- $\mathbf{u}$が$\mathbf{u}$自体によって影響を受ける、すなわち自己相関を持つ事を表す。
- 重み行列Wの主対角成分は0。つまり自分自身とは関係しない！他の要素と関係する！
- $u_i$が$\sum_{j=1}{W_{ij} u_j}$に依存する！
- これが上述した、"「誤差項ベクトルを生成するプロセス」をモデル化している"という意味！

## モデル式の解説:

- 回帰式(1.a)：
  - Y：住宅の販売価格を示すベクトル$\in \mathbb{R}^{N\times 1}$
  - X：住宅の特徴を表す行列$\in \mathbb{R}^{N \times K}$($K$は説明変数の数)
  - $\mathbf{u}$：空間的に相関する撹乱項ベクトル。$\in \mathbb{R}^{N\times 1}$
  - $\beta$：未知の回帰係数を示すベクトル $\in \mathbb{R}^{N\times 1}$
- 誤差項の相関関係を生成するプロセスを表す(1.b)
  - $\mathbf{\epsilon}$：各要素が独立した同一の一次元正規分布に従う誤差項ベクトル。
  - $\lambda$：未知の空間的自己相関パラメータ(スカラー)
    - つまり我々が最初に勉強した=空間的交互作用を考慮しないモデルは$\lambda=0$のケース！
    - $-1<\lambda<1$を仮定している。
    - 本論文では、プラスになる事=正の空間的自己相関が存在する事を期待する。
    - マイナスは珍しいらしい...。
      - ex)Aさんの家の値段が高い時、となりの家の価格が安い。
      - 自然界では起こりづらい?
  - $W$：データの空間構造(各観測地の空間的な関係)を表す重み行列$\in \mathbb{R^{n \times n}$

ここで分析者は、Wを事前に知っているものとみなしている。つまり、重み行列Wは推定すべきパラメータではなく、観測済みの値である。
従ってこの点で、**全ての分析結果は$W$の設定(特定)方法に依存**する！

- (例外としてPace et al 1998)
- このモデルは時系列のAR1モデルと似ている！
- また、時系列の場合と同様、様々な空間的なラグを用いる事でモデルを拡張する事ができる！

## 重み行列$W$の三種類の設定(特定)方法

重み行列Wは、このアプローチにおける最重要要素。

- Wは、主対角成分がゼロの、N×N行列。
- 非対角要素$W_{ij}$は、観察対象iとjの間の空間的関係を表す。
  Wの特定方法は主に三種類ある。

1. "最近傍Nearest Neighbors"を使用する方法
   - この方法(scheme)では、iとjが互いに最も近い関係にある場合に$W_{ij}=1$, それ以外の場合は$W_{ij}=0$とする
   - この手法は、1個の最近傍→n個の最近傍に簡単に拡張できる点が◎
     - ex. N-1個の内、iと最も近い上位n個のjに対してW_ij=1
2. 距離行列と閾値を元にした方法
   - iとjの間の距離が、事前に指定されたある閾値$L$よりも小さい場合に$W_{ij}=1$を設定する。
   - $W_{ij}=1 if D_{ij}\le L$
   - Dは距離行列。
3. 距離行列の逆数を元にした方法
   - Wの要素を2値化(0 or 1)するのではなく、$W_{ij}= \frac{1}{D^{p}_{ij}}$とする。
     - この場合、$W_{ij}>0$となる。
     - $p$は設定すべき定数。
   - 従って、観測地iとjの距離が近いほど、$D_{ij}$は小さく重み$W_{ij}$は大きくなる...！

上述した3つのW特定方法は、いずれも良く用いられるが、どの方法が住宅市場に表れる相関構造を最も良く実現しているかについては、合意が得られていない。

## 重み行列Wと撹乱項ベクトルuの関係性(Wを用いて、uの不均一分散性を表現している事を確認する。):

式(1.b)をuについて解くと、

$$ \mathbf{u} = (I - \lambda W)^{-1} \mathbf{\epsilon}$$

よって上記のuを、撹乱項ベクトルの共分散行列の式$V[\mathbf{u}] = E[\mathbf{u} \mathbf{u}^T]$に代入すると...

$$
V[\mathbf{u}] = E[\mathbf{u} \mathbf{u}^T] \\
= V[(I - \lambda W)^{-1} \mathbf{\epsilon}]
$$

(I - \lambda W)^{-1}は固定された(=非確率的な)行列なので、共分散行列の外側に出せる。

$$
(\because var[AX] = A \cdot var[X] \cdot A^T )\\
V[(I - \lambda W)^{-1} \mathbf{\epsilon}]
  = (I - \lambda W)^{-1} \cdot V[\mathbf{\epsilon}] \cdot ((I - \lambda W)^{-1})^T
$$

$V[\mathbf{\epsilon}] = \sigma^2 I$なので、

$$
= (I - \lambda W)^{-1} \cdot \sigma^2 I \cdot ((I - \lambda W)^{-1})^T
$$

転置と逆行列の性質(=順番入れ替え可能！)より、

$$
= (I - \lambda W)^{-1} \cdot \sigma^2 I \cdot ((I - \lambda W)^{T})^{-1}
$$

転置行列の性質より、

$$
= (I - \lambda W)^{-1} \cdot \sigma^2 I \cdot ((I^T - \lambda W^T)^{-1} \\
= (I - \lambda W)^{-1} \cdot \sigma^2 I \cdot ((I - \lambda W^T)^{-1}  \\
\because I^T = I
$$

スカラーである$\sigma^2$を前に出してきて...

$$
= \sigma^2 (I - \lambda W)^{-1} \cdot I \cdot (I - \lambda W^T)^{-1}
$$

ここで、V[u]はuの共分散行列。

- Vは通常、主対角線上に定数を持たない事に注意。
- ＝＞従ってこのタイプのモデルでは、uは分散不均一。（例え$\epsilon$が均一分散でも）

## 重み行列Wの各生成方法が意味する(自己)相関関係(相関図)

生成方法１～３のいずれでも、各観測データの位置が分かれば、距離行列$D$を計算する事ができる。
距離行列Dを元に、重み行列Wを計算できる。

相関図(Correlogram)は、空間的な依存関係を表現するのに便利なツール。
各ポイント間の相関関係を、ポイント間の距離の関数としてグラフ化したものである。

- 縦軸は、共分散行列V[u]の各要素である$V_{ij} = V_{ji}$の値。
- 横軸は、ポイントiとjの距離$D_{ij}=D_{ji}$の値。

Correlogramの良い特性は、「分離距離が増加すると、相関が減少する」こと
＝＞これは、Tobler(1970)の地理学の第一法則「**全てのモノは他の全てのモノに関係しているが、近くのモノは遠くのモノよりも関係している**」に従っている！

Correlogramは、観測データ(yやX)に基づいたものではなく、"観測地点と空間重み行列Wの生成方法が与えられた場合の母集団の相関図"である点に注意！！

もし、実際に観測された相関係数と距離の関係がむちゃくちゃ(Random)だったら、空間的な関係はない＝空間的な自己相関はない。
もしある関係性が観測(Non-Random)されたら、空間的な関係がある＝Spatial Autocorrelationが存在する！！

### 生成方法①Nearest Neighbor correlationの場合のCorrelogram
あ

### 生成方法②$W_{ij} = 1 if D_{ij} <= L$の場合のCorrelogram
あ

### 生成方法②$W_{ij} = \frac{1}{D_{ij}^p}$の場合のCorrelogram
あ

# 誤差項の共分散行列を直接モデル化する方法

$$
$$
