## refs

- [プロセスとは](https://qiita.com/ryomoucmei/items/e94b6d08a79abf9cc4d2)
- [bashの組込みコマンド自作によるスクリプトの高速化](https://satoru-takeuchi.hatenablog.com/entry/2020/03/26/010711)

# プロセスとは??

## psコマンド | プロセスの表示

```shell
$ps
  PID TTY           TIME CMD
15834 ttys000    0:00.00 /bin/bash
```

- `ps`コマンドは、現在のターミナルで実行されているプロセスだけを表示する。

  - 上の例では、shellのbashが動いてる、という意味。
  - `PID`:
    - Process ID: OS上で各プロセスを一意に識別するための番号。
  - `TTY`(Teletype)
    - 各プロセスが接続されている端末名。
    - ターミナルのタブ(1プロセスの画面)とイメージするとわかりやすい...?:thinking_face:
  - `TIME`:
    - プロセスがCPUを使用した累積時間。
  - `CMD`(Command):
    - プロセスを起動するのに使用されたコマンド。
    - 上の例では`/bin/bash`なので、Bash shellが起動されていることがわかる。

- ex)異なるターミナルのタブで、同じ`more test0214.txt`コマンド(=ともにファイルを表示する動作)を実行した場合、それぞれが異なる`TTY` & `PID`を持つことがわかる。

# processが実行される流れ:

- 1. コマンドを実行すると、Linuxカーネル(=OSの中核部分)が**ディスクから実行ファイルを読み出し、メモリに格納する**。
- 2. メモリに格納した内容に従って、CPUがプログラムを実行する。

## 各processは個別のメモリ領域を確保する

- 例えば同じmoreコマンドが3つ同時に実行された場合、それぞれ別のprocessとして、**異なるメモリ領域を確保して実行される**。
  - -> 処理が混じり合うことがない。
  - また、processには実行ユーザが設定されており、他のユーザのprocessは勝手に操作できない。
- 各processは process idという一意の識別子を持ち、**Linuxカーネルはprocess idを使ってprocessを管理する**。

# build-inコマンドの話

- `ps`コマンドや`cd`コマンドなど、shell(ex. bash)の**build-inコマンド**と呼ぶ。
  - `help`コマンドや`enable`コマンド(=これらもbuild-inコマンド)で、使用可能なbuild-inコマンドの一覧を出力できる。
- build-inコマンド以外は、**外部コマンドや外部プログラム**と呼ばれる。
  - `ls`や`grep`などは外部コマンド。
  - **外部コマンドは、shell自体の一部ではなく、ファイルシステム上に実行可能ファイルとして存在**する。
    - (通常は`/bin`, `/usr/bin`, `/usr/local/bin`などのディレクトリ以下に配置される)
  - 外部コマンドを使用する場合、shellはファイルシステムから実行ファイルを検索し、それを起動するために**新しいプロセスを作成**する。
- build-inコマンドは**shell内部で処理されるので、新しいprocessが生成されることはない**。
  - ex) `ps`コマンドを実行しても、`ps`コマンド自体は実行中processの一覧に表示されない。

## build-inコマンドが存在する動機:

- 次の2つの理由がある:
  - プログラムの高速化のため:
    - 新たなprocessの生成コスト(`fork()/exec()`)を削減できるため、外部プログラムと比較して大きく高速化できる。
  - shell自身の状態を変更させるため:
    - ex.) `cd`コマンドは、shellのカレントディレクトリを変更する。`cd`コマンドが外部プログラムだと、別のprocessで実行されるため、shellのprocessのカレントディレクトリが変更できない...!
- あるプログラムがボトルネックになっている場合、build-inコマンドを新たに追加することで解決する事例もあるっぽい??
  - 参考: [bashの組込みコマンド自作によるスクリプトの高速化](https://satoru-takeuchi.hatenablog.com/entry/2020/03/26/010711)

## shell scriptの実行コマンドで、build-inコマンドを使うか外部コマンドを使うか。

- (build-inコマンド)ドットコマンド `.`:
  - **新しくprocessを作らずに、現行のshellのprocessを使って**、指定された実行ファイルを読みこみプログラムを実行する。
- (外部コマンド)
