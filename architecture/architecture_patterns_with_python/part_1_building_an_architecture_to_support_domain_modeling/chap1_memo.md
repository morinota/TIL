# Chapter 1. Domain Modeling

ドメインモデリングの為のいくつかの重要なパターン: Entity, Value Object, Domain Service.

## What is Domain Model? ドメインモデルとは？

3層アーキテクチャの中心層 = ビジネスロジック層 = ドメインモデル

- ドメイン = 解決したい課題や自動化したいプロセス
- モデル = あるプロセスや現象について、有用な性質を捉えて構造化・単純化したもの

- ドメイン駆動設計（DDD）= ドメインモデルを構築しそのモデルを中心にアーキテクチャを構築する事
  - -> モデルを外部の制約からできる限り解放し、リファクタしやすくする.

本書で例題として解決したい課題: **在庫の割り当ての新しい方法(new allocation mechanism)**を導入したい.
じゃあこの場合のドメインは、"在庫を割り当てる行為やプロセス"かな?

## 1.2. Exploring the Domain Language ドメイン言語の探索

最初のプロセスとして、ドメインに関連する様々な用語を探索・定義する必要があるっぽい.

以下は、例題における用語.

- SKU(Stock-Keeping Unit):
  - "スキュー"と発音する.
  - 商品毎を識別する文字列. (商品名っぽい.)
  - ~~(ex. 椅子10個, ランプ1個, 鉛筆12本=1ダースみたいなイメージ?)~~
  - 顧客が注文した際には、注文毎にユニークな番号が付き、SKUとその個数が保存される.

以下は在庫に関する振る舞い(こうあるべきという挙動の定義?　ビズネスルール?)

- 在庫のバッチ(=ひとかたまり, DBにおける各行?)は、reference(id), SKU, 数量を保持している.
- 在庫バッチにorder line(注文書)を割り当てると、顧客の配送先に在庫が送られ、利用可能な量が減る.
  - ex) sku=SMALL-TABLEが20台分あり、2台分の受注枠を確保しました. -> 利用可能なSMALL-TABLEが20-2=18台になる.
- 在庫バッチで利用可能な数量が注文行の数量より少ない場合、注文を割り当てる事ができない.
  - ex) テーブル1台分のバッチと、テーブル2台分のオーダーラインがある.
  - この場合、バッチにオーダーラインを割り当てる事はできない.
- 同じ注文を2回割り当てることはできない.
  - 在庫バッチが10個あり、BLUE-VASEのオーダーラインを2個分確保した.
  - このオーダーラインを同じバッチに再度割り当てても、そのバッチの利用可能数量は8個のままとなるはず.
- バッチ(=在庫??)には、現在出荷(=倉庫に来る前??)中のケースも倉庫にあるケースもある.
  - 現在出荷中の場合はETAが表示される.
  - オーダーラインが入った際には、出荷中のバッチよりも倉庫内のバッチを優先的に割り当てる.
  - 出荷バッチは、ETAが早いものから順に割り当てる. (賞味期限があるような商品をイメージするといいかも!)

## 1.3. Unit Testing Domain Models ドメインモデルの単体テスト

いくつかのユニットテストを書いて、1.2で定義・探索したビジネスルール(= ドメインはこうあるべきという挙動の定義?)を、コードで表現してみる.

ユニットテスト内で定義した名称について: (1.2の際に一緒に定義・探索したビジネスマンに見せても意味が伝わるように.)

- テスト関数名: システムから得たい動作を記述.
- 使用するクラスと変数の名前: ビジネス用語から.

↑つまり、**1.2で探索したドメイン言語(Domain Language)を反映**している!!

pythonにおいてtype hintの有無はまだ論争の的になっているらしいが(そうなの...??)、特にドメインモデルにおいては、期待される引数が何であるかを明確にしたり文書化したりするのに役立つ.
