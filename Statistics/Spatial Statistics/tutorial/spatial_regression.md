## link

- https://geographicdata.science/book/notebooks/11_regression.html

# Spatial Regression

回帰（そしてより一般的な予測）は、空間構造がどのように我々のデータの理解と分析に役立つかを調べるための完璧なケースを提供する。
この章では、特に線形回帰に焦点を当て、予測アルゴリズムの検証と改善のために空間構造をどのように利用できるかを議論する。

# What is spatial regression and why should I care?

- 通常、空間構造は回帰モデルに2つの方法で影響を与えます。

## 空間構造が回帰モデルに与える影響1⃣

- まず（そして最も明確な）空間がデータに影響を与える方法は、**データを生成するプロセス自体が明示的に空間的である場合**です。
  - ここでは、一戸建ての家の値段のようなものを考えてみましょう。
  - 同じ品質の家でも、より良い学区に住むために、個人が家の値段にプレミアムを支払うことはよくあることです。
  - また、排水処理施設やリサイクル施設、広い高速道路など、騒音や化学物質の汚染源に近い住宅は、実は私たちが予想するよりも安いかもしれません。喘息などの場合、職場や娯楽施設など、一日のうちで移動することの多い場所が、住所以上に健康に影響を与えることがある。
  - この場合、ある場所の喘息発症率を予測するために、他の場所のデータを使用する必要がある場合があります。
  - 具体的にどのようなケースであろうと、ここでは、**地理は特徴である。地理的なプロセスから結果が得られるので、結果についての予測をするのに直接役立つ**のである。

## 空間構造が回帰モデルに与える影響

- もう一つの方法（より懐疑的な理解）は、地理学の道具的価値をしぶしぶ認めるものである。
  - 予測手法や分類法の分析では、しばしば、何が間違っているのかを分析することに関心がある。
  - これは計量経済学でよくあることで、分析者はモデルがある種のオブザベーションを系統的に間違って予測することを懸念することがあります。
  - もし我々のモデルが、既知のオブザベーションの集合や入力のタイプに対して、日常的に悪いパフォーマンスをすることがわかっているなら、これを説明できれば、我々はより良いモデルを作ることができるかもしれない。
  - 他の種類の誤差診断の中で、**地理は誤差の構造を評価するのに非常に有用な埋め込みを提供してくれる**。
  - 分類・予測エラーをマッピングすることで、データの中にエラーのクラスターがあるかどうかを示すことができます。
  - もし、**ある地域では他の地域よりも誤差が大きくなる傾向がある**ことがわかれば（あるいは、誤差が観測間で「伝染」することがわかれば）、この構造を利用して、よりよい予測をすることができるかもしれません。

## 空間構造をモデルに含めるモチベーション

- 誤差の空間的な構造は、地理が何らかの属性であるべきなのに、それをどのようにモデルに含めればよいのかがはっきりしない場合に生じるかもしれません。
- また、他の特徴があり、その特徴の欠落がエラーの空間的パターンを引き起こしている場合もあります。
- この追加的な特徴が含まれていれば、その構造は消えるでしょう。
- あるいは、予測因子として選んだ特徴の間の複雑な相互作用や相互依存関係から発生し、結果として予測ミスに本質的な構造をもたらすかもしれない。
- 社会的プロセスのモデルで使用する予測変数のほとんどは、具象化された空間情報を含んでいる：
  - モデルで無料で得られる、その特徴に内在するパターン。
- **意図的であろうとなかろうと、空間的にパターン化された予測因子をモデルで使用すると、空間的にパターン化されたエラーが生じる可能性がある**。
- したがって、**真のプロセスが明示的に地理的であるかどうかにかかわらず、我々の観測の間の空間的関係についての追加情報、あるいは近隣のサイトについてのより多くの情報は、我々の予測をより良くすることができる**のである。

## 本章の内容は...!

この章では、従来の回帰のフレームワークに空間を組み込む。

- まず、地理的な参照を排除した標準的な線形回帰モデルから始める。
- そこから、3つの主要な方法で空間と空間的関係を定式化する。
  - 第一に、外生変数(Exogenous Variables)として埋め込む
    - 単に説明変数として？？
  - 第二に、空間的不均質性(Spatial Heterogeneity)、、すなわち空間横断的な結果の系統的変動(Systematic variation)として。
    - 階層ベイズで、回帰係数に空間的な違いを考慮する？？
  - 第三に、依存性(Dependence)、すなわち空間的隣人(Spatial Neighbors)の特性に関連する効果として。
    - 空間重み行列を使って説明変数に間接効果を加えるやつ？？

全体を通して、我々は技術的な詳細よりも、各アプローチが内包する概念的な違いに焦点を当てる。

```python
from pysal.lib import weights
from pysal.explore import esda
import numpy
import pandas
import geopandas
import matplotlib.pyplot as plt
import seaborn
import contextily
```

# サンプルデータ: San Diego AirBnB

# Non-Spatial Regression, a (very) quick refresh

## Hidden Structures

# 空間情報を埋め込む方法1:Spatial Feature Engineering: Proximity Variables(近接変数)

# 空間情報を埋め込む方法2:Spatial Heterogeneity(空間的異質性)

## Spatial Fixed Effects

## Spatial Regimes

# 空間情報を埋め込む方法3:Spatial Dependence

## Exogenous Effects: The SLX Model

## Spatial Error

## Spatial Lag

## Other ways of bringing space into regression
