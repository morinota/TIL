# Debiased offline evaluation of recommender systems: a weighted-sampling approach

published date: 30 March 2020,
authors: Diego Carraro, Derek Bridge
url(paper): https://dl.acm.org/doi/10.1145/3341105.3375759
(勉強会発表者: morinota)

---

## どんなもの?

LINEさんの推薦システムのアルゴリズム評価にてこの論文のアプローチを活用してる、との話を聞き読んでみました...!! (参考: [LINEサービス向けの効率的かつ効果的な推薦システム開発に向けて -日本語版-](https://www.youtube.com/watch?v=GgfsclpdSjY))

- 推薦システムのオフライン評価は、多くの場合、様々な交絡因子によって生成されたbiasを含む過去のデータに依存するよ.
  - このようなデータは、**ユーザとアイテムの interaction はMNAR（Missing Not At Random）**だよ. (i.e. 評価行列内の欠損値の発生傾向がランダムではない、という事だよ!)
- MNARテストデータによる推薦システムの性能測定は、biasを軽減するための工夫がない限り、オンライン環境での性能を正しく反映しない事が多いよ.
  - biasを除去する一つのアプローチは、**MNARテストデータで使用するための新しい不偏の性能推定量**を設計する事だよ. (i.e. 損失関数やmetricの形を、真に求めたいオンライン性能の不偏推定量になるように変形させる事だよ.)
- ただ本論文では、別のアプローチとして**サンプリングアプローチ**を対象に調査しているよ.
  - サンプリングアプローチの一般的なアイデアは、MNARデータに対してサンプリング戦略を用いて、よりbiasの少ない **intervened(=介入) test set**を生成する事だよ.
    - intervened(=介入) test set は、u&iのinteractionが**MAR(Missing At Random)**であるデータ、もしくは少なくともよりMARに近いデータを目指すよ.
  - 例えば **SKEW** という手法では、**"アイテムの人気度"がinteractionの観測されやすさに与える影響**(交絡効果)を調整する事を目的としてサンプリング戦略を工夫しているよ.
- 本論文では、SKEWの拡張ver.として、サンプリングアプローチの為の新しい定式化を提案しているよ.
  - ざっくり説明すると、MNARデータにおけるユーザとアイテムの分布と、目指すべき不偏のMAR分布との**乖離**を考慮して重みを計算する、**重み付けサンプリング戦略**だよ.
- 提案した戦略は、**高い汎用性(ex. 推薦システムの学習にも利用可能!)** と **低いoverheads(ex. 事前の学習を必要としない)**の利点があるよ.
- 本論文で提案した手法は、Implicit feedbackにもexplicit feedbackにも適用可能...!!(フレームワークのgenerality、素晴らしい...!)

## 先行研究と比べて何がすごい?

MNARな観測データセットを用いた古典的なオフライン評価は、実質的に、観測データセットから欠落したinteraction(i.e. 評価行列内のゼロ要素だよ!)は、**MCAR(Missing Completely At Random)**または**MAR(Missing At Random)**のいずれかであると仮定しているよ.
MNARデータをMCARやMARであるかのように推薦アルゴリズムの評価で使用すると、真の推薦システム性能の偏った推定結果になるよ.

### MNARデータによる推薦アルゴリズム評価に対処する3種のアプローチ

- 1. 最も簡単なアプローチは(少なくとも理論的には)、オフライン評価のためにMNARデータセットの代わりにMARデータセットを収集し採用することだよ.
  - 評価に（偏りのない）MARデータを使用することで、レコメンダーの性能を偏りなく推定することができるよ.
  - ドメインによっては、小さなMARのようなデータセットを収集する方法があるよ.
  - しかし、多くのドメインでは、MARのようなデータセットを入手するのは非現実的であったり、コストがかかりすぎたりして困難だよ.
  - よって、他の2つの方法では、入手可能で量も多いMNARデータを使用しつつ、そのバイアスを軽減する事に焦点を当てているよ.
- 2. MNARテストデータのバイアスを補正する推定量(＝evaluation metrics)を設計することだよ. (MNARデータによる学習時の目的関数も同様に補正するよ.)
  - バイアス軽減の目的をある程度達成する事ができるよ.
  - ただ不偏推定量には2つの潜在的な欠点があるよ.
    - 欠点1: バイアスのすべての原因を克服するのに十分な汎用性がないかもだよ. (全ての原因に対応する推定量を設計するのはかなり難しくてかつ複雑になりそう...!)
    - 欠点2: 観測データがいくつかの特定の仮定・条件を満たす場合にのみ、不偏性が証明される推定量が多いよ. (ex. 推薦結果が決定的ではなく確率的に生成されている必要がある、etc.)
- 3. 評価(や学習?)に使う前に、MNARのテストデータ(や学習データ?)にintervene(介入)することだよ.
  - 実際には、この"介入"は、利用可能なMNARテストデータからサンプリングするサンプリング戦略によって実行されるよ.
    - サンプリング戦略は、介在するテストセットが偏りにくく(よりMARに近づくように...!)、レコメンダーの性能評価に適していると考えられるように選択されるよ.
  - 有名なサンプリング戦略の一つに、SKEWがあるよ.
    - アイテムの人気度に反比例してユーザとアイテムの interaction をサンプリングし、人気バイアスを低減したテストデータを作成するよ.

本論文では、第三のアプローチに関連して、intervenedデータ を生成するためのSKEWサンプリング戦略に代わる新しい方法を調査・提案するよ.
本手法は一般的であり、**レコメンダーのトレーニングに使用するデータをdebiasする**ためにも採用できるよ.
あと、本論文では、SKEWの有効性を実証的に検証するよ...!

### MNAR, MAR, MCARと欠損データメカニズム

MNAR, MAR, MCARの区分は欠損データ分析理論(missing data analysis theory)に基づいており、最初に[16]によって提案され、後に[18]によって推薦者システムの文献に紹介されたよ.

- 元論文[16,18]によるMARとMCARの区分:
  - MCAR:
    - ユーザとアイテムのinteractionが欠損しているかどうかは、interaction value(ratingの星の数の違いや、clickとpurchaseの違いなど)に全く依存しない、つまり、**観測された interaction value にも欠損した interaction value にも依存しないこと**を意味するよ.
  - MAR:
    - ユーザとアイテムのinteractionが欠損しているかどうかは、**観測されたinteraction valueには依存するかもしれないが、欠損したinteraction valueには依存しないこと**を意味するよ.
      - 欠損値の発生はランダムだが、非ゼロ要素の中の分布はランダムではない...!(ex. ユーザは星5の方が、星1よりもratingをつけやすい...!)

## 技術や手法の肝は？

- メモ: 推薦システムの文脈でいう"交絡因子"の解釈について.
  - 因果推論の文脈で"交絡因子"とは、「交絡因子->原因変数, 交絡因子->結果変数」の向きに因果関係が存在する場合に、「原因変数->結果変数」の間に擬似的な相関関係を発生させるような第三の因子。
  - 推薦システムだとどう解釈したらいいんだろう...?以下の様な感じ?
    - 原因: ユーザuがアイテムiを好き!
    - 結果: ユーザuとアイテムiの間にInteraction(ex. click, purchase, rating)が記録される.
    - 交絡因子: (ex. アイテムの表示される位置、人気なアイテムはユーザの目につきやすい、過去に推薦したアイテムがユーザに見られやすい、星1のアイテムよりも星5のアイテムの方がratingをつけやすい、etc.)
      - 推薦システムの文脈における"交絡因子"は、必ずしも因果関係の矢印の向きは気にする必要なさそう...! ざっくり「原因->結果」の間に擬似的な相関関係を発生させるような第三の因子、みたいな.

### MARデータセットとMNARデータセットの特性を分析する為の確率的フレームワークを定義

### Intervened Testデータの生成

## どうやって有効だと検証した?

提案したサンプリング手法をSKEWと比較するよ.
この実験により、SKEWの有効性を初めて実証的に評価することができたよ.

## 議論はある？

## 次に読むべき論文は？

## お気持ち実装
