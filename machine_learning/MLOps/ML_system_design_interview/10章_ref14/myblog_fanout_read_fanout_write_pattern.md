# ニュースフィード生成の2パターンのアーキテクチャ fan-out read　と　fan-out write　について調べたメモ

## これは何?

- [ブログ記事「Design a News Feed System」](https://liuzhenglaichn.gitbook.io/system-design/news-feed/design-a-news-feed-system) を読んで、fan-out read パターンと fan-out write パターンを初めて知ったので、自分なりの理解と思ったことをまとめたメモ。
  - なお、ブログ中における「ニュースフィードシステム」は、どちらかというとニュースアプリというよりSNSアプリの各ユーザの投稿が表示されるフィード機能をイメージしてる。

## 背景: パーソナライズされたニュースフィードシステムの設計

- SNSメディアアプリには、ニュースフィード機能がある。
  - ニュースフィードは、システム内の他のentity(ユーザやメディア)によって生成された、投稿(テキスト, 画像, 動画を含む)のリスト。各ユーザごとにカスタマイズされている。
  - 他のentity達が新しい投稿を作成しながら、ニュースフィードは常に更新される。

### 要件:

- 機能要件(functional requirements):
  - ニュースフィードは、ユーザがフォローしているシステム内の他のエンティティからの投稿や、ユーザが興味を持つ可能性のある投稿を使用して生成される。
  - 投稿にはテキスト、画像、動画が含まれる場合がある。
  - 他のユーザによって作られた新しい投稿は、ユーザのニュースフィードに追加されるべき。
- 非機能要件(non-functional requirements):
  - ニュースフィードの生成: ほぼリアルタイムで行われるべき。エンドユーザが感じるレイテンシは1~2秒であるべき。
  - 新しい投稿の追加: 新しい投稿がシステムに送信された後、ニュースフィードに表示されるまでに5秒以上かかるべきではない。
  

### 容量の推定(Capacity Estimation):

- (このあたりの推定の手順とか考え方とか、参考になりそうだった...!:thinking:)
- 最初にFacebookの余談:
  - 2019年の時点で、Facebookは約16.6億のDAUを報告してる。
  - MAUのうち、DAUは66%を占めている。
  - MAUは25億人を超えている。
  - 2020年3月時点での世界人口は78億人。
  - つまり、世界人口の約21%がFacebookのDAUであり、約32%がMAUであることを意味する。すごすぎるね。
- 架空のSNSシステムのトラフィックなどを推定していく:
  - 今回の架空のSNSシステムは、10億のDAUがあると仮定。1ユーザあたりの平均フォロイー数は500人とする。
  - トラフィック推定: 
    - 平均して一人のユーザが1日に10回ニュースフィードを取得すると仮定する。
    - → ニュースフィードリクエスト数は10億ユーザ x 10回 = 100億リクエスト/日 、約116,000 クエリ/毎秒(QPS)と推定できる。
  - ストレージ推定:
    - 平均して、各ユーザのニュースフィードの500件の投稿をメモリに保持し、迅速に取得できるようにすると仮定。各投稿のサイズは平均1KB。
    - → 1ユーザあたり500KB、全DAUで合計500TB。各マシンが100GBのメモリを持つと仮定すると、5,000台のマシンが必要と推定できる。


