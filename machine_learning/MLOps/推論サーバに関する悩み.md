# メモ

- パーソナライズ推薦機能を動画アプリで実現したい場合、どのようなアーキテクチャ構成が望ましいのか迷っている。
  - 主にAWSの計算資源の上で動画アプリが稼働している。
  - アプリ内では、オンライン推薦とバッチ推薦、両方のユースケースが存在する。
    - ex. メイン画面の表示記事は、オンライン推薦。一方で、動画に対する関連動画の表示や、プッシュ通知する動画の選定はバッチ推薦。
- 現状の構成:
  - オンライン推薦: 推薦サーバがECS on EC2上で稼働している。バッチで作った特徴量をキャッシュしておき、バックエンドサーバからリクエストを受けるとリアルタイムで推薦結果を作って返す。
  - バッチ推薦: バッチ推薦パイプラインで作った推薦結果をS3に保存しておき、それをバックエンドサーバのRDS (MySQL)にロードしておく。バックエンドサーバは、ユーザのリクエストに応じてRDSからデータを取得して返す。

## 大きな懸念: バックエンドサーバと推薦システムの関係性

バックエンドサーバは、推薦結果を取得する際、オンライン推薦とバッチ推薦のどちらを使うべきかを判断する必要がある。理由を上手く言語化できていないが、なんとなくバックエンドサーバは、推薦結果を作る処理がバッチかオンラインかを気にする必要はないし、すべきでない気がしている。なので、バックエンドサーバが共通のインターフェースを通じて、推薦結果を取得できるようにすべきなのかなと思っている。

### いまいちな理由を、chatGPTと喋りながら言語化してみる

- 関心の分離(というか**ソフトウェアの複雑性管理の観点**...!:thinking:)
  - バックエンドサーバは、システム全体の中で他のコンポーネント(ex. 推薦システム)とのinteractionを担うが、**推薦システムの実装の詳細については知る必要がないし知るべきではない**。
  - バックエンドサーバの実装が推薦システムの内部的な処理(バッチかオンラインか)に依存することは、**システムの複雑性を増加させ、将来的な変更しやすさ(i.e. ソフトウェアプロダクトの持続可能な成長)を阻害する可能性がある**。
  - ->　バックエンドサーバは「どのように推薦結果が作られるか」(i.e. 実装の詳細...!:thinking:)ではなく、「推薦結果を取得すること」(i.e. )にのみ知るべき。つまり、推論の実行方式（バッチ vs オンライン）は推薦システム側で判断され、バックエンドサーバはその実装の詳細を気にせず、結果を取得するだけで十分。

### この懸念を解決するには、どのようなアーキテクチャ構成が望ましいか？

- バックエンドサーバと推薦システムの間に、**共通のインターフェースを設けることが重要**。
  - -> これにより、バックエンドサーバは一貫した方法で推薦結果を取得できるようになる。
- 実装の考え方:
  - APIゲートウェイやFacadeパターンを使って、バックエンドサーバは単一のAPI内の複数のエンドポイントにアクセスし、各ユースケースに応じた推薦結果を取得できるようにする。
    - 例えば、`/recommendations/user2movie/{user_id}` や `/recommendations/user2user/{user_id}` のように、エンドポイントは共通のプレフィックスを持ち、後半部分で異なるユースケースを指定する形式にする

### 理想的なアーキテクチャ構成を具体的にどう実現する?

("理想的な" = おそらく複雑性管理の観点から理想的...!:thinking:)
