## refs:

- [今さら聞けないAWS ECSとは？Fargateとは？](https://qiita.com/K5K/items/0d8dbdb39fbb0375e2bd)

# ECSの話

## ECSって何のためのもの??

- ECS = AWSが提供する、フルマネージドなコンテナオーケストレーションサービス。
  - orchestration = 管理的な?
  - コンテナのorchestratorを使わない場合...
    - 特定のEC2インスタンスに対して、dockerコマンドを実行して、コンテナを起動したりする。(なるほど, EC2アイコンのcomponentはそうやってるのかな...!:thinking:)
    - 管理対象が少なければOK。
    - でも管理対象のコンテナが増えていくと、管理が複雑になり、操作ミスなどのリスク増
      - ex.) コンテナAをインスタンスAで起動して、コンテナBをインスタンスBで起動して..., そのコンテナをload balancerと接続して...etc.
  - コンテナのorchestratorを使うと...
    - コンテナの起動、停止、スケールアウト、スケールイン、ローリングアップデート、ローリングデプロイメントなどが簡単に行える。
    - **また、単一のコンテナを複数のEC2インスタンスで起動させたり...!** (なるほど! こういったauto scaling等ができるのはECSが頑張ってくれてるのか...!!:thinking:)

## 参考: AWS のコンテナorchestrationサービス
- ECS(Elastic Container Service)
  - 小規模/中規模ワークロードに適している
  - AWS独自のソフトウェアがベース
- EKS(Elastic Kubernetes Service)
  - 大規模ワークロードに適している
  - Kubernetesがベース
- (あ、ECSとEKSって似たような役割のサービスなのか...!:thinking:)

AWSのコンテナ関連サービスは、大きく分けて以下の3つが存在し、相互に連携してサービスを稼働させる:

- コンテナorchestrationサービス
  - ex. ECS, EKS
- コンテナの実行環境
  - ex. AWS Fargate, Amazon Elastic Compute Cloud (EC2)
  - （EC2は、コンピューターがクラウド上にあるだけ、って認識で良さそう:thinking:）
- イメージレジストリ
  - ex. Amazon Elastic Container Registry (ECR)

## ECSの構成要素

以下の4つの要素で構成される:

- 1. クラスター(cluster): **ただの箱!**
  サービスとタスクを分離するための論理グループ。
  - 実行環境やIAM ロールなどをクラスター単位で設定できる。
- 4. サービス (service): **タスクの管理人!**
  - 起動タイプを指定する (EC2 or Fargate)
  - タスク実行数を定義
  - タスク数を維持
  - ELB(ロードバランサー)との連携
- 2. タスク: **アプリケーションを実行するコンテナ集合**
  - アプリケーションの実行単位。
  - 1つ以上のコンテナから構成される。
  - 同じタスクのコンテナは、同じhost上で稼働する。
- 3. タスク定義(task definition): **タスクの金型**
  - タスクを構成するためのテンプレート。
  - JSON形式で記述される。

ECSにおけるコンテナの実行方法は、以下の2つがある:

- 方法1: タスクから直接実行
  - コンテナが終了したら、タスクも終了する。
  - batch処理などで利用される。
- 方法2: サービスから実行
  - サービスは、指定されたタスクの実行数を維持する。
  - ELBなどのほかのサービスと連携が可能。
  - Webアプリケーションなどの常時起動するオンライン処理にて利用される。

# Fargateの話

- Fargate = ECSで利用可能な**サーバレスのコンテナ実行環境**。
  - Fargateを使う場合、ECSはインスタンスの運用管理をしなくて良くなる。
- インスタンスタイプが選択できない。タスクが起動するごとにCPUが変更される可能性がある。
